
# Lab 04: ESP32 Sensor Web Display - DHT Temperature and Humidity

**Build a real-time environmental monitoring web dashboard**

Combine sensor readings with web server technology to create a live temperature and humidity monitoring system accessible from any browser on your network.

----------

## Objectives

-   Interface DHT11 or DHT22 temperature and humidity sensor with ESP32.
    
-   Display real-time sensor readings on a web page with automatic updates.
    
-   Implement AJAX for live data refresh without full page reload.
    
-   Create visually appealing gauges and charts for sensor data visualization.
    

----------

## Hardware Requirements

-   1× ESP32 development board
    
-   1× DHT11 or DHT22 sensor module
    
-   3× Jumper wires (Female-to-Male or Male-to-Male depending on sensor)
    
-   1× 10kΩ pull-up resistor (if using bare DHT sensor, not required for modules)
    
-   Breadboard (optional)
    

----------

## DHT Sensor Pinout

**DHT11/DHT22 (3-pin module version):**

-   VCC → ESP32 3.3V
    
-   DATA → ESP32 GPIO 27 (or any GPIO)
    
-   GND → ESP32 GND
    

**DHT11/DHT22 (4-pin bare sensor):**

-   Pin 1 (VCC) → ESP32 3.3V
    
-   Pin 2 (DATA) → ESP32 GPIO 27 + 10kΩ resistor to VCC
    
-   Pin 3 (NC) → Not connected
    
-   Pin 4 (GND) → ESP32 GND
    

**Connection Image:**  
[![ESP32 DHT11 DHT22 Temperature and Humidity Arduino IDE Circuit Schematic Diagram](https://i0.wp.com/randomnerdtutorials.com/wp-content/uploads/2019/03/ESP32-DHT-wiring_bb.png?resize=828%2C917&quality=100&strip=all&ssl=1)](https://i0.wp.com/randomnerdtutorials.com/wp-content/uploads/2019/03/ESP32-DHT-wiring_bb.png?quality=100&strip=all&ssl=1)

----------

## Library Installation

Install DHT sensor library:

1.  Open Arduino IDE
    
2.  Sketch → Include Library → Manage Libraries
    
3.  Search "DHT sensor library" by Adafruit
    
4.  Click Install
    
5.  Also install "Adafruit Unified Sensor" when prompted
    

----------

## Complete Code: Temperature and Humidity Web Server

```cpp
#include <WiFi.h>
#include <WebServer.h>
#include <DHT.h>

// WiFi credentials
const char* ssid = "YourNetworkName";
const char* password = "YourNetworkPassword";

// DHT Sensor setup
#define DHTPIN 27         // GPIO pin connected to DHT sensor
#define DHTTYPE DHT22     // Change to DHT11 if using DHT11
DHT dht(DHTPIN, DHTTYPE);

// Web server on port 80
WebServer server(80);

// Variables to store sensor readings
float temperature = 0.0;
float humidity = 0.0;

// HTML page with auto-refresh JavaScript
String getHTML() {
  String html = "<!DOCTYPE html><html>";
  html += "<head><meta name='viewport' content='width=device-width, initial-scale=1.0'>";
  html += "<title>ESP32 Weather Station</title>";
  html += "<style>";
  html += "body { font-family: Arial; text-align: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); margin: 0; padding: 20px; }";
  html += "h1 { color: white; margin-top: 20px; }";
  html += ".container { max-width: 800px; margin: 0 auto; }";
  html += ".card { background: white; border-radius: 15px; padding: 30px; margin: 20px 0; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }";
  html += ".reading { display: inline-block; width: 45%; margin: 10px; }";
  html += ".icon { font-size: 80px; margin: 10px; }";
  html += ".value { font-size: 48px; font-weight: bold; color: #667eea; }";
  html += ".label { font-size: 20px; color: #666; margin-top: 10px; }";
  html += ".timestamp { color: #999; font-size: 14px; margin-top: 20px; }";
  html += "</style>";
  html += "<script>";
  html += "setInterval(function() {";
  html += "  fetch('/data').then(response => response.text()).then(data => {";
  html += "    var values = data.split(',');";
  html += "    document.getElementById('temp').innerHTML = values;";
  html += "    document.getElementById('humid').innerHTML = values;";
  html += "    document.getElementById('time').innerHTML = 'Updated: ' + new Date().toLocaleTimeString();";
  html += "  });";
  html += "}, 2000);";  // Update every 2 seconds
  html += "</script>";
  html += "</head>";
  html += "<body>";
  html += "<div class='container'>";
  html += "<h1>ESP32 Weather Station</h1>";
  html += "<div class='card'>";
  html += "<div class='reading'>";
  html += "<div class='value' id='temp'>" + String(temperature, 1) + "</div>";
  html += "<div class='label'>Temperature (°C)</div>";
  html += "</div>";
  html += "<div class='reading'>";
  html += "<div class='value' id='humid'>" + String(humidity, 1) + "</div>";
  html += "<div class='label'>Humidity (%)</div>";
  html += "</div>";
  html += "<div class='timestamp' id='time'>Updated: " + String(millis()/1000) + "s</div>";
  html += "</div>";
  html += "</div>";
  html += "</body></html>";
  return html;
}

void handleRoot() {
  server.send(200, "text/html", getHTML());
}

void handleData() {
  String data = String(temperature, 1) + "," + String(humidity, 1);
  server.send(200, "text/plain", data);
}

void setup() {
  Serial.begin(115200);
  
  // Initialize DHT sensor
  dht.begin();
  
  // Connect to WiFi
  WiFi.begin(ssid, password);
  Serial.print("Connecting to WiFi");
  
  while (WiFi.status() != WL_CONNECTED) {
    delay(500);
    Serial.print(".");
  }
  
  Serial.println("\nWiFi Connected!");
  Serial.print("IP Address: ");
  Serial.println(WiFi.localIP());
  
  // Define server routes
  server.on("/", handleRoot);
  server.on("/data", handleData);
  server.begin();
  
  Serial.println("Web server started");
  Serial.print("Access at: http://");
  Serial.println(WiFi.localIP());
}

void loop() {
  server.handleClient();
  
  // Read sensor every 2 seconds (DHT sensors are slow)
  static unsigned long lastRead = 0;
  if (millis() - lastRead >= 2000) {
    lastRead = millis();
    
    float newTemp = dht.readTemperature();
    float newHumid = dht.readHumidity();
    
    // Check if readings are valid
    if (!isnan(newTemp) && !isnan(newHumid)) {
      temperature = newTemp;
      humidity = newHumid;
      
      Serial.print("Temperature: ");
      Serial.print(temperature);
      Serial.print(" °C | Humidity: ");
      Serial.print(humidity);
      Serial.println(" %");
    } else {
      Serial.println("Failed to read from DHT sensor!");
    }
  }
}


 ```

----------

## How It Works

## Sensor Reading

-   **dht.begin():**  Initializes DHT sensor communication.
    
-   **dht.readTemperature():**  Returns temperature in Celsius (use readTemperature(true) for Fahrenheit).
    
-   **dht.readHumidity():**  Returns relative humidity percentage.
    
-   **isnan() check:**  Verifies reading is valid number (sensor occasionally returns NaN on read errors).
    

## AJAX Live Updates

-   **setInterval():**  JavaScript function runs every 2000ms (2 seconds).
    
-   **fetch('/data'):**  Requests latest sensor data from /data endpoint without reloading page.
    
-   **Split and update:**  Parses comma-separated values and updates HTML elements by ID.
    

----------

## Troubleshooting

Symptom

Cause

Solution

NaN readings

Wrong pin or sensor type

Verify GPIO pin and DHTTYPE matches your sensor

All zeros

Sensor not powered

Check VCC and GND connections

Intermittent failures

No pull-up resistor

Add 10kΩ resistor between DATA and VCC

Readings don't update

Server not handling requests

Ensure server.handleClient() called in loop()

Page loads but no data

/data endpoint issue

Check server.on("/data", handleData) defined

----------

## Enhancements

**Add More Sensors:**  Extend to multiple DHT sensors on different GPIO pins or add other sensors (BME280 for pressure, DS18B20 for waterproof temp).

**Data Logging:**  Store readings in arrays and create historical charts using Chart.js library.

**Alerts:**  Add threshold checking and LED/buzzer alerts for high temperature or humidity.

**Cloud Upload:**  Combine with Lab 03 to send readings to ThingSpeak or other IoT platforms.
