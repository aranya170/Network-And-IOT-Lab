# SPI Communication

## Introduction
Serial Peripheral Interface (SPI) is a synchronous serial communication protocol used for high-speed data transfer between microcontrollers and peripheral devices like sensors, displays, and memory modules. SPI operates using a master-slave architecture and supports full-duplex communication.

---

## Features of SPI
- Synchronous communication using a clock signal (SCLK).
- Full-duplex data transfer.
- Faster than UART and I2C.
- Uses four main lines: MOSI, MISO, SCLK, and SS.

---

## SPI Pin Configuration
SPI uses the following four main lines:
1. **MOSI (Master Out, Slave In)** - Data sent from master to slave.
2. **MISO (Master In, Slave Out)** - Data sent from slave to master.
3. **SCLK (Serial Clock)** - Clock signal generated by the master.
4. **SS (Slave Select)** - Used to select the slave device (Active Low).

### SPI Pins on Arduino
| Arduino Model | MOSI | MISO | SCLK | SS  |
|--------------|------|------|------|-----|
| Uno/Nano    | 11   | 12   | 13   | 10  |
| Mega        | 51   | 50   | 52   | 53  |

---

## Basic SPI Communication Code (Master and Slave)

### **Master Code (Arduino as Master)**
```cpp
#include <SPI.h>

void setup() {
    SPI.begin();
    pinMode(10, OUTPUT); // SS pin as output
    Serial.begin(9600);
}

void loop() {
    digitalWrite(10, LOW); // Enable Slave
    SPI.transfer(0x55);    // Send data to Slave
    digitalWrite(10, HIGH); // Disable Slave
    Serial.println("Data Sent: 0x55");
    delay(1000);
}
```

### **Slave Code (Arduino as Slave)**
```cpp
#include <SPI.h>
volatile byte receivedData;

void setup() {
    pinMode(MISO, OUTPUT);
    SPCR |= _BV(SPE); // Enable SPI in slave mode
    SPI.attachInterrupt(); // Enable SPI interrupt
    Serial.begin(9600);
}

ISR(SPI_STC_vect) {
    receivedData = SPDR; // Read received data
}

void loop() {
    Serial.print("Received Data: ");
    Serial.println(receivedData, HEX);
    delay(1000);
}
```

---

## **SPI with Multiple Slaves**
For multiple slaves, each slave needs a separate **SS** pin. Example:
```cpp
#define SS1 10
#define SS2 9

void setup() {
    SPI.begin();
    pinMode(SS1, OUTPUT);
    pinMode(SS2, OUTPUT);
}

void loop() {
    digitalWrite(SS1, LOW);
    SPI.transfer(0xA1);
    digitalWrite(SS1, HIGH);

    digitalWrite(SS2, LOW);
    SPI.transfer(0xB2);
    digitalWrite(SS2, HIGH);

    delay(1000);
}
```

---

## **Common SPI Devices & Libraries**
SPI is widely used in various devices, and Arduino provides built-in SPI support. Here are some common SPI-based devices:

| Device | Library |
|--------|---------|
| SD Card | SD.h |
| OLED Display | Adafruit_GFX.h & Adafruit_SSD1306.h |
| RFID Module | MFRC522.h |
| SPI Flash Memory | SPIFlash.h |

---

## **Troubleshooting SPI Communication**
1. **No response from slave?**
   - Ensure correct MOSI, MISO, SCLK, and SS connections.
   - Check that the slave device supports SPI communication.
2. **Corrupt or missing data?**
   - Verify clock speed (use `SPI.setClockDivider()` if needed).
   - Avoid long delays in the slave code that may cause missed transmissions.
3. **Multiple slaves not working?**
   - Ensure only one slaveâ€™s SS pin is LOW at a time.

---

## **Conclusion**
SPI is a powerful and fast communication protocol that is widely used for interfacing microcontrollers with sensors, memory modules, and displays. By using the SPI library in Arduino, we can easily communicate with multiple devices at high speeds.


